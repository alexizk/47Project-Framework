<UserControl x:Class="_47Project.Nexus.Pages.PlanRunPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ctrl="clr-namespace:_47Project.Nexus.Controls"
             Background="Transparent">
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- Header -->
    <Border Background="{DynamicResource App.Surface}" BorderBrush="{DynamicResource App.Border}"
            BorderThickness="1" CornerRadius="14" Padding="14" Margin="0,0,0,10">
      <StackPanel>
        <TextBlock Text="Run Plan" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,8"/>
        <DockPanel LastChildFill="True">
          <Button Content="Browseâ€¦" Width="92" Margin="0,0,8,0" Command="{Binding BrowsePlanCommand}"/>
          <TextBox Text="{Binding PlanPath}" VerticalContentAlignment="Center"/>
        </DockPanel>

        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
          <TextBlock Text="Mode:" VerticalAlignment="Center" Margin="0,0,8,0"/>
          <ComboBox Width="140" SelectedValue="{Binding Mode}">
            <ComboBoxItem Content="WhatIf"/>
            <ComboBoxItem Content="Apply"/>
          </ComboBox>
          <Button Content="Run" Padding="14,8" Margin="12,0,0,0" Command="{Binding RunPlanCommand}"/>
          <TextBlock Text="{Binding RunStatus}" Margin="12,0,0,0" VerticalAlignment="Center"/>
        </StackPanel>
      </StackPanel>
    </Border>

    <!-- Body -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="360"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <ctrl:StepTimelineControl Grid.Column="0"
                                ItemsSource="{Binding Steps}"
                                SelectedItem="{Binding SelectedStep, Mode=TwoWay}"/>

      <Grid Grid.Column="1" Margin="10,0,0,0">
        <Grid.RowDefinitions>
          <RowDefinition Height="2*"/>
          <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Step output + artifacts -->
        <ctrl:LogViewerControl Grid.Row="0"/>

        <!-- Raw journal -->
        <Border Grid.Row="1" Background="{DynamicResource App.Surface}" BorderBrush="{DynamicResource App.Border}"
                BorderThickness="1" CornerRadius="14" Padding="12" Margin="0,10,0,0">
          <DockPanel>
            <TextBlock DockPanel.Dock="Top" Text="Journal" FontWeight="SemiBold" Margin="2,0,0,8"/>
            <DataGrid ItemsSource="{Binding Events}" AutoGenerateColumns="False" CanUserAddRows="False"
                      IsReadOnly="True" HeadersVisibility="Column" GridLinesVisibility="None">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Time" Binding="{Binding TsUtc}" Width="2*"/>
                <DataGridTextColumn Header="StepId" Binding="{Binding StepId}" Width="*"/>
                <DataGridTextColumn Header="Type" Binding="{Binding StepType}" Width="*"/>
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="*"/>
                <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="3*"/>
              </DataGrid.Columns>
            </DataGrid>
          </DockPanel>
        </Border>
      </Grid>
    </Grid>
  </Grid>
</UserControl>
