<UserControl x:Class="_47Project.Nexus.Controls.LogViewerControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="Transparent">
  <Border Background="{DynamicResource App.Surface}" BorderBrush="{DynamicResource App.Border}"
          BorderThickness="1" CornerRadius="14" Padding="12">
    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>

      <DockPanel Grid.Row="0" LastChildFill="True" Margin="0,0,0,8">
        <TextBlock Text="Step output" FontWeight="SemiBold" Margin="2,0,0,0"/>
        <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
          <CheckBox Content="Live" Margin="0,0,10,0" IsChecked="{Binding LiveTailEnabled}"/>
          <CheckBox Content="Auto-scroll" Margin="0,0,10,0" IsChecked="{Binding AutoScrollEnabled}"/>
          <Button Content="Open folder" Margin="0,0,8,0" Padding="10,6"
                  Command="{Binding OpenStepFolderCommand}"/>
          <Button Content="Refresh" Padding="10,6"
                  Command="{Binding RefreshArtifactsCommand}"/>
        </StackPanel>
      </DockPanel>

      <Grid Grid.Row="1">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="2*"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <TabControl Grid.Column="0">
          <TabItem Header="stdout">
            <TextBox x:Name="StdoutBox" Text="{Binding SelectedStdout}" FontFamily="Consolas" FontSize="12"
                     TextWrapping="NoWrap" IsReadOnly="True" VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Auto"/>
          </TabItem>
          <TabItem Header="stderr">
            <TextBox x:Name="StderrBox" Text="{Binding SelectedStderr}" FontFamily="Consolas" FontSize="12"
                     TextWrapping="NoWrap" IsReadOnly="True" VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Auto"/>
          </TabItem>
        </TabControl>

        <Border Grid.Column="1" BorderBrush="{DynamicResource App.Border}" BorderThickness="1"
                CornerRadius="12" Padding="10" Margin="10,0,0,0">
          <DockPanel>
            <TextBlock DockPanel.Dock="Top" Text="Artifacts" FontWeight="SemiBold" Margin="0,0,0,8"/>
            <ListBox ItemsSource="{Binding SelectedArtifacts}" BorderThickness="0" Background="Transparent">
              <ListBox.ItemTemplate>
                <DataTemplate>
                  <DockPanel Margin="0,2">
                    <Button DockPanel.Dock="Right" Content="Open" Padding="8,4"
                            Command="{Binding DataContext.OpenArtifactCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            CommandParameter="{Binding FullPath}"/>
                    <StackPanel>
                      <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                      <TextBlock FontSize="12" Foreground="{DynamicResource App.SubtleText}">
                        <TextBlock.Text>
                          <MultiBinding StringFormat="{}{0:n0} bytes â€¢ {1:u}">
                            <Binding Path="SizeBytes"/>
                            <Binding Path="LastWriteTimeUtc"/>
                          </MultiBinding>
                        </TextBlock.Text>
                      </TextBlock>
                    </StackPanel>
                  </DockPanel>
                </DataTemplate>
              </ListBox.ItemTemplate>
            </ListBox>
          </DockPanel>
        </Border>
      </Grid>
    </Grid>
  </Border>
</UserControl>
