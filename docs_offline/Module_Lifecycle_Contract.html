<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Module_Lifecycle_Contract.md</title>
<style>
body { font-family: system-ui, Segoe UI, Arial, sans-serif; margin: 2rem; line-height: 1.5; max-width: 1100px; }
pre { white-space: pre-wrap; word-wrap: break-word; background: #f6f8fa; padding: 1rem; border-radius: 12px; }
code { background: #f6f8fa; padding: 0.1rem 0.2rem; border-radius: 6px; }
a { color: #0b57d0; }
table { border-collapse: collapse; }
td, th { border: 1px solid #ddd; padding: 6px 10px; }
</style>
</head>
<body>
<h1>Module Lifecycle Contract</h1>

<p>All modules follow a consistent lifecycle so the Nexus Shell can manage them predictably.</p>

<h2>Required module manifest fields</h2>

<p>See <code>schemas/module_manifest_v1.schema.json</code>.</p>

<h2>PowerShell entrypoint</h2>

<p>A module entrypoint is a <code>.psm1</code> referenced by <code>entrypoint</code> in <code>module.json</code>.</p>

<h2>Required exported functions (v1)</h2>

<p>Each module must export:</p>

<ul>
<li><p><code>Initialize-47Module</code></p>

<ul>
<li>Called once after import.</li>
<li>Returns a hashtable describing module runtime state.</li>
</ul></li>
<li><p><code>Get-47ModuleCommands</code></p>

<ul>
<li>Returns a list of commands the Nexus Shell can expose.</li>
</ul></li>
<li><p><code>Get-47ModuleSettingsSchema</code></p>

<ul>
<li>Returns JSON Schema (or a reference to one) describing module settings.</li>
</ul></li>
<li><p><code>Invoke-47ModuleRun</code></p>

<ul>
<li>Executes the moduleâ€™s primary action(s), typically driven by a plan step.</li>
</ul></li>
<li><p><code>Invoke-47ModuleSelfTest</code></p>

<ul>
<li>Returns a structured health report.</li>
</ul></li>
</ul>

<h2>Optional exported functions</h2>

<ul>
<li><code>Invoke-47ModuleDoctor</code> (module-specific environment checks)</li>
<li><code>Invoke-47ModuleMigrations</code> (settings/data migrations)</li>
</ul>

<h2>Capability enforcement</h2>

<p>Modules must call <code>Test-47CapabilityAllowed</code> before performing actions requiring permissions.</p>

<h2>Error handling</h2>

<ul>
<li>Throw terminating errors for non-recoverable issues.</li>
<li>Prefer structured error objects for diagnostics in support bundles.</li>
</ul>

<h2>Versioning</h2>

<ul>
<li><code>module.apiLevel</code> is the compatibility key.</li>
<li>Framework supports API levels per <code>docs/Compatibility.md</code>.</li>
</ul>

</body>
</html>
